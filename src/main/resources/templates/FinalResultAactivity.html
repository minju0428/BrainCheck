<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>최종 결과 - 캐릭터 해석 검증</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 설득 라운드 페이지에서 가져온 커스텀 스타일 */
        :root {
            --primary-purple: #a238ff;
            --secondary-pink: #ff3ca6;
            --bg-gradient: radial-gradient(circle at top left, #e0f2fe 0%, #f3e8ff 50%, #ffffff 100%);
            --button-gradient-base: linear-gradient(90deg, #b862ff, #ff71c6);
            --button-gradient-hover: linear-gradient(90deg, #a238ff, #ff3ca6);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
        }

        .ui-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            border: 1px solid #f3f4f6;
        }

        .info-card {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
        }

        /* MBTI 결과 태그 스타일 */
        .mbti-tag-user {
            background-color: #6C5CE7;
            color: white;
            padding: 4px 12px;
            border-radius: 9999px;
            font-weight: 600;
        }
        .mbti-tag-ai {
            background-color: #1A73E8;
            color: white;
            padding: 4px 12px;
            border-radius: 9999px;
            font-weight: 600;
        }

        /* 차원별 결과 카드 스타일 */
        .dimension-result-card {
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        /* 불일치 (설득 성공) - 퍼플/핑크 계열 */
        .mismatch-success {
            background-color: #fef0ff;
            border: 1px solid #ff71c6;
        }
        /* 일치 (완벽 일치) - 그린 계열 */
        .match-perfect {
            background-color: #f0fff8;
            border: 1px solid #68d391;
        }

        .persuasion-bar-container {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            flex-grow: 1;
        }

        /* 설득 성공 바 (퍼플/핑크 그라데이션) */
        .persuasion-fill {
            height: 100%;
            background: linear-gradient(90deg, #b862ff, #ff71c6);
            border-radius: 4px;
        }
        /* 완벽 일치 바 (그린) */
        .match-fill {
            height: 100%;
            background-color: #68d391;
            border-radius: 4px;
        }

        .result-icon {
            font-size: 1.5rem;
            width: 24px;
            height: 24px;
        }

        .icon-check {
            color: #28a745;
        }
        .icon-cross {
            color: #dc3545;
        }

        /* AI 상세 분석 지표 스타일 */
        .ai-analysis-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            border: 1px solid #f3f4f6;
            margin-bottom: 1rem;
        }
        .ai-analysis-header {
            font-weight: bold;
            color: #6C5CE7;
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .mbti-dim-tag {
            color: white;
            padding: 2px 8px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.75rem;
            text-align: center;
            width: 32px;
        }
        .tag-blue {
            background-color: #3b82f6;
        }
        .tag-gray {
            background-color: #9ca3af;
        }
        .dim-row {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .dim-center {
            flex-grow: 1;
            text-align: center;
            font-weight: 600;
            color: #374151;
            margin: 0 1rem;
        }
        .dim-bar-container {
            height: 40px;
            background-color: #f3f4f6;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            margin-top: 8px;
            margin-bottom: 12px;
        }
        .dim-bar-visual {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
        }
        .dim-bar-left {
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dim-bar-right {
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: row-reverse;
        }
        .dim-bar-fill {
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        .dim-bar-fill-blue {
            background-color: #6C5CE7;
        }
        .dim-bar-fill-gray {
            background-color: #9ca3af;
        }
        .dim-bar-text {
            position: relative;
            z-index: 10;
            font-size: 0.875rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .dim-bar-change {
            font-size: 0.625rem;
            font-weight: 500;
            opacity: 0.9;
        }
        .dim-percent {
            width: 50%;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #1f2937;
        }

        /* 라운드별 설득률 스타일 */
        .round-rates-container {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #e5e7eb;
        }
        .round-rate-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .round-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            width: 4rem;
        }
        .round-rate-bar {
            flex-grow: 1;
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        .round-rate-fill {
            height: 100%;
            background: linear-gradient(90deg, #b862ff, #ff71c6);
            border-radius: 3px;
        }
        .round-rate-value {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            width: 3rem;
            text-align: right;
        }

        /* 홈으로 가기 버튼 스타일 */
        #home-button {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            background-image: var(--button-gradient-base);
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(162, 56, 255, 0.4);
            transition: background-image 0.3s ease, color 0.3s ease, opacity 0.3s ease;
            text-decoration: none;
        }

        #home-button:hover {
            background-image: var(--button-gradient-hover);
        }
    </style>
</head>
<body class="flex justify-center py-8 px-4">

<div class="max-w-xl w-full text-left space-y-4">

    <div class="flex flex-col items-center justify-center">
        <h3 class="text-xl font-bold text-gray-900">최종 결과</h3>
        <p class="text-sm text-gray-500">당신의 캐릭터 해석(캐해력) 검증 결과입니다</p>
    </div>

    <div class="ui-card info-card mb-6">
        <div class="flex items-center space-x-4">
            <div class="flex-grow">
                <p class="text-xl font-bold text-gray-800" th:text="${characterName}">독고</p>
                <p class="text-sm text-gray-500" th:text="${title}">불편한 편의점</p>
            </div>
        </div>

        <div class="flex flex-col items-end space-y-1 text-xs">
            <span class="mbti-tag-user" th:text="|당신: ${fullMbti}|">당신: ESTJ</span>
            <span class="mbti-tag-ai" th:text="|AI: ${aiThing}|">AI: ISFJ</span>
        </div>
    </div>

    <div class="ui-card ai-analysis-card">
        <div class="ai-analysis-header">
            <i data-lucide="award" class="w-5 h-5 mr-2 text-yellow-500"></i>
            종합 캐해력 평가 및 계급
        </div>

        <div class="flex flex-col items-center py-4">
            <div class="text-3xl font-extrabold text-transparent bg-clip-text"
                 style="background-image: linear-gradient(90deg, #b862ff, #ff71c6);"
                 id="final-tier-name">
            </div>
            <p class="text-sm font-semibold text-gray-700 mt-2" id="avg-persuasion-rate">
            </p>
        </div>

        <div class="mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg">
            <p class="text-xs font-bold text-gray-700 mb-1">캐해력 분석</p>
            <p class="text-sm text-gray-600" id="tier-description">
            </p>
        </div>
    </div>
    <div class="ai-analysis-card">
        <div class="ai-analysis-header">
            <i data-lucide="line-chart" class="w-5 h-5 mr-2"></i>
            AI 분석 상세 지표 (퍼센트)
        </div>

        <div th:if="${eiPersuaded}">
            <div class="dim-row">
                <div class="mbti-dim-tag" th:classappend="${finalE >= finalI} ? 'tag-blue' : 'tag-gray'">E</div>
                <div class="dim-center">에너지의 방향성</div>
                <div class="mbti-dim-tag" th:classappend="${finalI >= finalE} ? 'tag-blue' : 'tag-gray'">I</div>
            </div>
            <div class="dim-bar-container">
                <div class="dim-bar-visual">
                    <div class="dim-bar-left" th:style="|width: ${finalE}%;|">
                        <div class="dim-bar-fill dim-bar-fill-blue" th:style="|width: 100%;|" th:if="${finalE >= finalI}"></div>
                        <div class="dim-bar-fill dim-bar-fill-gray" th:style="|width: 100%;|" th:if="${finalE < finalI}"></div>
                        <div class="dim-bar-text">
                            <span th:text="|${finalE}%|">72%</span>
                            <span class="dim-bar-change" th:if="${changeE != null and changeE > 0}" th:text="|+${changeE}%|">+27%</span>
                        </div>
                    </div>
                    <div class="dim-bar-right" th:style="|width: ${finalI}%;|">
                        <div class="dim-bar-fill dim-bar-fill-blue" th:style="|width: 100%;|" th:if="${finalI >= finalE}"></div>
                        <div class="dim-bar-fill dim-bar-fill-gray" th:style="|width: 100%;|" th:if="${finalI < finalE}"></div>
                        <div class="dim-bar-text">
                            <span th:text="|${finalI}%|">28%</span>
                            <span class="dim-bar-change" th:if="${changeI != null and changeI > 0}" th:text="|+${changeI}%|">+5%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${snPersuaded}">
            <div class="dim-row">
                <div class="mbti-dim-tag" th:classappend="${finalS >= finalN} ? 'tag-blue' : 'tag-gray'">S</div>
                <div class="dim-center">인식 기능</div>
                <div class="mbti-dim-tag" th:classappend="${finalN >= finalS} ? 'tag-blue' : 'tag-gray'">N</div>
            </div>
            <div class="dim-bar-container">
                <div class="dim-bar-visual">
                    <div class="dim-bar-left" th:style="|width: ${finalS}%;|">
                        <div class="dim-bar-fill dim-bar-fill-blue" th:style="|width: 100%;|" th:if="${finalS >= finalN}"></div>
                        <div class="dim-bar-fill dim-bar-fill-gray" th:style="|width: 100%;|" th:if="${finalS < finalN}"></div>
                        <div class="dim-bar-text">
                            <span th:text="|${finalS}%|">75%</span>
                            <span class="dim-bar-change" th:if="${changeS != null and changeS > 0}" th:text="|+${changeS}%|">+5%</span>
                        </div>
                    </div>
                    <div class="dim-bar-right" th:style="|width: ${finalN}%;|">
                        <div class="dim-bar-fill dim-bar-fill-blue" th:style="|width: 100%;|" th:if="${finalN >= finalS}"></div>
                        <div class="dim-bar-fill dim-bar-fill-gray" th:style="|width: 100%;|" th:if="${finalN < finalS}"></div>
                        <div class="dim-bar-text">
                            <span th:text="|${finalN}%|">25%</span>
                            <span class="dim-bar-change" th:if="${changeN != null and changeN > 0}" th:text="|+${changeN}%|">+5%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${tfPersuaded}">
            <div class="dim-row">
                <div class="mbti-dim-tag" th:classappend="${finalT >= finalF} ? 'tag-blue' : 'tag-gray'">T</div>
                <div class="dim-center">판단 기능</div>
                <div class="mbti-dim-tag" th:classappend="${finalF >= finalT} ? 'tag-blue' : 'tag-gray'">F</div>
            </div>
            <div class="dim-bar-container">
                <div class="dim-bar-visual">
                    <div class="dim-bar-left" th:style="|width: ${finalT}%;|">
                        <div class="dim-bar-fill dim-bar-fill-blue" th:style="|width: 100%;|" th:if="${finalT >= finalF}"></div>
                        <div class="dim-bar-fill dim-bar-fill-gray" th:style="|width: 100%;|" th:if="${finalT < finalF}"></div>
                        <div class="dim-bar-text">
                            <span th:text="|${finalT}%|">61%</span>
                            <span class="dim-bar-change" th:if="${changeT != null and changeT > 0}" th:text="|+${changeT}%|">+5%</span>
                        </div>
                    </div>
                    <div class="dim-bar-right" th:style="|width: ${finalF}%;|">
                        <div class="dim-bar-fill dim-bar-fill-blue" th:style="|width: 100%;|" th:if="${finalF >= finalT}"></div>
                        <div class="dim-bar-fill dim-bar-fill-gray" th:style="|width: 100%;|" th:if="${finalF < finalT}"></div>
                        <div class="dim-bar-text">
                            <span th:text="|${finalF}%|">39%</span>
                            <span class="dim-bar-change" th:if="${changeF != null and changeF > 0}" th:text="|+${changeF}%|">+5%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${jpPersuaded}">
            <div class="dim-row">
                <div class="mbti-dim-tag" th:classappend="${finalJ >= finalP} ? 'tag-blue' : 'tag-gray'">J</div>
                <div class="dim-center">생활 양식</div>
                <div class="mbti-dim-tag" th:classappend="${finalP >= finalJ} ? 'tag-blue' : 'tag-gray'">P</div>
            </div>
            <div class="dim-bar-container">
                <div class="dim-bar-visual">
                    <div class="dim-bar-left" th:style="|width: ${finalJ}%;|">
                        <div class="dim-bar-fill dim-bar-fill-blue" th:style="|width: 100%;|" th:if="${finalJ >= finalP}"></div>
                        <div class="dim-bar-fill dim-bar-fill-gray" th:style="|width: 100%;|" th:if="${finalJ < finalP}"></div>
                        <div class="dim-bar-text">
                            <span th:text="|${finalJ}%|">80%</span>
                            <span class="dim-bar-change" th:if="${changeJ != null and changeJ > 0}" th:text="|+${changeJ}%|">+5%</span>
                        </div>
                    </div>
                    <div class="dim-bar-right" th:style="|width: ${finalP}%;|">
                        <div class="dim-bar-fill dim-bar-fill-blue" th:style="|width: 100%;|" th:if="${finalP >= finalJ}"></div>
                        <div class="dim-bar-fill dim-bar-fill-gray" th:style="|width: 100%;|" th:if="${finalP < finalJ}"></div>
                        <div class="dim-bar-text">
                            <span th:text="|${finalP}%|">20%</span>
                            <span class="dim-bar-change" th:if="${changeP != null and changeP > 0}" th:text="|+${changeP}%|">+5%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="flex items-center text-gray-600 font-bold mb-4">
        <i data-lucide="zap" class="w-5 h-5 mr-2 text-purple-500"></i>
        <h4 class="text-lg">차원별 대결 결과</h4>
    </div>

    <div class="dimension-result-card space-y-3" th:if="${eiPersuaded}" th:classappend="${eiMismatch} ? 'mismatch-success' : 'match-perfect'">
        <div class="flex justify-between items-center">
            <span class="font-bold text-gray-800">에너지 방향</span>
            <div class="flex items-center space-x-1 text-sm font-semibold">
                <span class="text-purple-600" th:text="|당신: ${ei}|">당신: E</span>
                <i data-lucide="x" class="result-icon icon-cross" th:if="${eiMismatch}"></i>
                <i data-lucide="check" class="result-icon icon-check" th:if="${!eiMismatch}"></i>
                <span class="text-blue-600" th:text="|AI: ${aiEi}|">AI: I</span>
            </div>
        </div>

        <div class="flex items-center space-x-3">
            <div class="persuasion-bar-container">
                <div th:if="${eiMismatch}" class="persuasion-fill" th:style="|width: ${eiPersuasionRate}%;|"></div>
                <div th:if="${!eiMismatch}" class="match-fill" style="width: 100%;"></div>
            </div>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${eiMismatch}" th:text="|총 설득률: ${eiPersuasionRate}%|">
                총 설득률: 91%
            </span>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${!eiMismatch}">완벽 일치</span>
        </div>

        <div class="round-rates-container" th:if="${eiMismatch}">
            <div class="text-xs font-semibold text-gray-600 mb-2">라운드별 설득률</div>
            <div th:if="${eiRoundRates != null and !eiRoundRates.isEmpty()}">
                <div class="round-rate-item" th:each="rate, iterStat : ${eiRoundRates}">
                    <span class="round-label" th:text="|라운드 ${iterStat.index + 1}|">라운드 1</span>
                    <div class="round-rate-bar">
                        <div class="round-rate-fill" th:style="|width: ${rate}%;|"></div>
                    </div>
                    <span class="round-rate-value" th:text="|${rate}%|">0%</span>
                </div>
            </div>
            <div class="text-xs text-gray-400 italic" th:if="${eiRoundRates == null or eiRoundRates.isEmpty()}">
                라운드 데이터가 없습니다.
            </div>
        </div>

        <div class="flex items-center text-sm font-semibold text-green-600 pt-1">
            <i data-lucide="check-square" class="result-icon icon-check mr-1"></i>
            <span th:if="${eiMismatch}">설득력 있는 논거를 제시했습니다!</span>
            <span th:if="${!eiMismatch}">100% 일치</span>
        </div>
    </div>

    <div class="dimension-result-card space-y-3" th:if="${snPersuaded}" th:classappend="${snMismatch} ? 'mismatch-success' : 'match-perfect'">
        <div class="flex justify-between items-center">
            <span class="font-bold text-gray-800">인식 기능</span>
            <div class="flex items-center space-x-1 text-sm font-semibold">
                <span class="text-purple-600" th:text="|당신: ${sn}|">당신: S</span>
                <i data-lucide="x" class="result-icon icon-cross" th:if="${snMismatch}"></i>
                <i data-lucide="check" class="result-icon icon-check" th:if="${!snMismatch}"></i>
                <span class="text-blue-600" th:text="|AI: ${aiSn}|">AI: S</span>
            </div>
        </div>

        <div class="flex items-center space-x-3">
            <div class="persuasion-bar-container">
                <div th:if="${snMismatch}" class="persuasion-fill" th:style="|width: ${snPersuasionRate}%;|"></div>
                <div th:if="${!snMismatch}" class="match-fill" style="width: 100%;"></div>
            </div>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${snMismatch}" th:text="|총 설득률: ${snPersuasionRate}%|">
                총 설득률: 0%
            </span>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${!snMismatch}">완벽 일치</span>
        </div>

        <div class="round-rates-container" th:if="${snMismatch}">
            <div class="text-xs font-semibold text-gray-600 mb-2">라운드별 설득률</div>
            <div th:if="${snRoundRates != null and !snRoundRates.isEmpty()}">
                <div class="round-rate-item" th:each="rate, iterStat : ${snRoundRates}">
                    <span class="round-label" th:text="|라운드 ${iterStat.index + 1}|">라운드 1</span>
                    <div class="round-rate-bar">
                        <div class="round-rate-fill" th:style="|width: ${rate}%;|"></div>
                    </div>
                    <span class="round-rate-value" th:text="|${rate}%|">0%</span>
                </div>
            </div>
            <div class="text-xs text-gray-400 italic" th:if="${snRoundRates == null or snRoundRates.isEmpty()}">
                라운드 데이터가 없습니다.
            </div>
        </div>

        <div class="flex items-center text-sm font-semibold text-green-600 pt-1">
            <i data-lucide="check-square" class="result-icon icon-check mr-1"></i>
            <span th:if="${snMismatch}">설득력 있는 논거를 제시했습니다!</span>
            <span th:if="${!snMismatch}">100% 일치</span>
        </div>
    </div>

    <div class="dimension-result-card space-y-3" th:if="${tfPersuaded}" th:classappend="${tfMismatch} ? 'mismatch-success' : 'match-perfect'">
        <div class="flex justify-between items-center">
            <span class="font-bold text-gray-800">판단 기능</span>
            <div class="flex items-center space-x-1 text-sm font-semibold">
                <span class="text-purple-600" th:text="|당신: ${tf}|">당신: T</span>
                <i data-lucide="x" class="result-icon icon-cross" th:if="${tfMismatch}"></i>
                <i data-lucide="check" class="result-icon icon-check" th:if="${!tfMismatch}"></i>
                <span class="text-blue-600" th:text="|AI: ${aiTf}|">AI: F</span>
            </div>
        </div>

        <div class="flex items-center space-x-3">
            <div class="persuasion-bar-container">
                <div th:if="${tfMismatch}" class="persuasion-fill" th:style="|width: ${tfPersuasionRate}%;|"></div>
                <div th:if="${!tfMismatch}" class="match-fill" style="width: 100%;"></div>
            </div>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${tfMismatch}" th:text="|총 설득률: ${tfPersuasionRate}%|">
                총 설득률: 100%
            </span>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${!tfMismatch}">완벽 일치</span>
        </div>

        <div class="round-rates-container" th:if="${tfMismatch}">
            <div class="text-xs font-semibold text-gray-600 mb-2">라운드별 설득률</div>
            <div th:if="${tfRoundRates != null and !tfRoundRates.isEmpty()}">
                <div class="round-rate-item" th:each="rate, iterStat : ${tfRoundRates}">
                    <span class="round-label" th:text="|라운드 ${iterStat.index + 1}|">라운드 1</span>
                    <div class="round-rate-bar">
                        <div class="round-rate-fill" th:style="|width: ${rate}%;|"></div>
                    </div>
                    <span class="round-rate-value" th:text="|${rate}%|">0%</span>
                </div>
            </div>
            <div class="text-xs text-gray-400 italic" th:if="${tfRoundRates == null or tfRoundRates.isEmpty()}">
                라운드 데이터가 없습니다.
            </div>
        </div>

        <div class="flex items-center text-sm font-semibold text-green-600 pt-1">
            <i data-lucide="check-square" class="result-icon icon-check mr-1"></i>
            <span th:if="${tfMismatch}">설득력 있는 논거를 제시했습니다!</span>
            <span th:if="${!tfMismatch}">100% 일치</span>
        </div>
    </div>

    <div class="dimension-result-card space-y-3" th:if="${jpPersuaded}" th:classappend="${jpMismatch} ? 'mismatch-success' : 'match-perfect'">
        <div class="flex justify-between items-center">
            <span class="font-bold text-gray-800">생활 양식</span>
            <div class="flex items-center space-x-1 text-sm font-semibold">
                <span class="text-purple-600" th:text="|당신: ${jp}|">당신: J</span>
                <i data-lucide="x" class="result-icon icon-cross" th:if="${jpMismatch}"></i>
                <i data-lucide="check" class="result-icon icon-check" th:if="${!jpMismatch}"></i>
                <span class="text-blue-600" th:text="|AI: ${aiJp}|">AI: J</span>
            </div>
        </div>

        <div class="flex items-center space-x-3">
            <div class="persuasion-bar-container">
                <div th:if="${jpMismatch}" class="persuasion-fill" th:style="|width: ${jpPersuasionRate}%;|"></div>
                <div th:if="${!jpMismatch}" class="match-fill" style="width: 100%;"></div>
            </div>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${jpMismatch}" th:text="|총 설득률: ${jpPersuasionRate}%|">
                총 설득률: 0%
            </span>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${!jpMismatch}">완벽 일치</span>
        </div>

        <div class="round-rates-container" th:if="${jpMismatch}">
            <div class="text-xs font-semibold text-gray-600 mb-2">라운드별 설득률</div>
            <div th:if="${jpRoundRates != null and !jpRoundRates.isEmpty()}">
                <div class="round-rate-item" th:each="rate, iterStat : ${jpRoundRates}">
                    <span class="round-label" th:text="|라운드 ${iterStat.index + 1}|">라운드 1</span>
                    <div class="round-rate-bar">
                        <div class="round-rate-fill" th:style="|width: ${rate}%;|"></div>
                    </div>
                    <span class="round-rate-value" th:text="|${rate}%|">0%</span>
                </div>
            </div>
            <div class="text-xs text-gray-400 italic" th:if="${jpRoundRates == null or jpRoundRates.isEmpty()}">
                라운드 데이터가 없습니다.
            </div>
        </div>

        <div class="flex items-center text-sm font-semibold text-green-600 pt-1">
            <i data-lucide="check-square" class="result-icon icon-check mr-1"></i>
            <span th:if="${jpMismatch}">설득력 있는 논거를 제시했습니다!</span>
            <span th:if="${!jpMismatch}">100% 일치</span>
        </div>
    </div>

    <div class="max-w-xl w-full pt-6">
        <a th:href="@{/}" id="home-button" class="w-full font-bold py-3 rounded-full shadow-lg text-lg">
            <span>홈으로 가기</span>
            <i data-lucide="home" class="w-5 h-5"></i>
        </a>
    </div>

</div>


<script>
    // Lucide Icons 초기화
    lucide.createIcons();


    const eiMismatch = true;
    const snMismatch = false;
    const tfMismatch = true;
    const jpMismatch = false;

    const eiPersuasionRate = 91;
    const snPersuasionRate = 0; // 일치했으므로 0 (혹은 설득 시도 안 함)
    const tfPersuasionRate = 100;
    const jpPersuasionRate = 0; // 일치했으므로 0 (혹은 설득 시도 안 함)


    function evaluatePersuasionTier() {
        let totalRate = 0;
        let mismatchedCount = 0;

        // 불일치(Mismatch)하여 설득이 필요했던 차원의 설득률만 계산에 포함
        if (eiMismatch) {
            totalRate += eiPersuasionRate;
            mismatchedCount++;
        }
        if (snMismatch) {
            totalRate += snPersuasionRate;
            mismatchedCount++;
        }
        if (tfMismatch) {
            totalRate += tfPersuasionRate;
            mismatchedCount++;
        }
        if (jpMismatch) {
            totalRate += jpPersuasionRate;
            mismatchedCount++;
        }

        let averageRate = 0;
        if (mismatchedCount > 0) {
            averageRate = Math.round((totalRate / mismatchedCount) * 10) / 10; // 소수점 첫째 자리까지 반올림
        } else {
            // 모든 차원이 완벽 일치한 경우 (최고 티어 부여)
            return {
                rate: 100,
                name: "캐해력 갓",
                description: "AI의 초기 분석과 모든 차원에서 완벽하게 일치했거나, 모든 불일치 차원을 100% 설득했습니다. 캐릭터 해석의 신입니다!"
            };
        }

        let tierName = "";
        let tierDescription = "";

        if (averageRate >= 95.0) {
            tierName = "캐해력 갓";
            tierDescription = "당신의 캐릭터 해석은 AI의 초기 분석을 거의 완벽하게 반박하고 새로운 결론을 도출했습니다. 캐릭터의 숨겨진 면모까지 꿰뚫어 보는 통찰력을 지녔으며, 논리 정연하고 강력한 근거를 바탕으로 AI를 압도했습니다.";
        } else if (averageRate >= 80.0) {
            tierName = "캐해력 왕";
            tierDescription = "매우 뛰어난 캐릭터 해석 능력을 보여주었습니다. 대부분의 차원에서 AI를 성공적으로 설득했으며, 캐해 분야의 권위자로 인정받을 자격이 있습니다.";
        } else if (averageRate >= 60.0) {
            tierName = "캐해력 마스터";
            tierDescription = "준수한 캐릭터 해석 능력을 갖추었습니다. 어려운 차원에서도 일정 수준 이상의 설득력을 발휘했으며, 탄탄한 기본기를 바탕으로 한 해석력을 입증했습니다.";
        } else if (averageRate >= 40.0) {
            tierName = "캐해력 전문가";
            tierDescription = "캐릭터에 대한 이해도는 높으나, 일부 차원에서 설득력이 부족했습니다. 캐릭터의 깊은 이해를 위해 다양한 관점의 자료를 참고할 필요가 있습니다.";
        } else {
            tierName = "캐해력 초보";
            tierDescription = "캐릭터 해석의 여정은 이제 막 시작되었습니다. AI와의 대결에서 아쉬운 결과를 보였지만, 캐릭터와 서사에 대한 깊이 있는 분석을 통해 성장할 수 있습니다.";
        }

        return { rate: averageRate, name: tierName, description: tierDescription, count: mismatchedCount };
    }

    // 결과 출력 함수 실행
    const result = evaluatePersuasionTier();

    document.getElementById('final-tier-name').textContent = result.name;
    document.getElementById('avg-persuasion-rate').textContent = `평균 설득률: ${result.rate}% (${result.count}개 불일치 차원 기준)`;
    document.getElementById('tier-description').textContent = result.description;



</script>
</body>
</html>
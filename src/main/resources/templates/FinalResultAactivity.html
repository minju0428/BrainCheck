<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>최종 결과 - 캐릭터 해석 검증</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 설득 라운드 페이지에서 가져온 커스텀 스타일 */
        :root {
            --primary-purple: #a238ff;
            --secondary-pink: #ff3ca6;
            --bg-gradient: radial-gradient(circle at top left, #e0f2fe 0%, #f3e8ff 50%, #ffffff 100%);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
        }

        .ui-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            border: 1px solid #f3f4f6;
        }

        .info-card {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
        }

        /* 설득 결과 요약 박스 스타일 */
        .persuasion-summary-box {
            background-color: #e0f2fe;
            border-radius: 8px;
            padding: 1rem;
            font-weight: 500;
            color: #1e40af;
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .persuasion-summary-box i {
            color: #f59e0b;
            margin-right: 0.5rem;
        }

        /* 최종 결과 전용 스타일 */
        .result-header {
            text-align: center;
            padding-bottom: 1rem;
        }

        /* MBTI 결과 태그 스타일 */
        .mbti-tag-user {
            background-color: #6C5CE7;
            color: white;
            padding: 4px 12px;
            border-radius: 9999px;
            font-weight: 600;
        }
        .mbti-tag-ai {
            background-color: #1A73E8;
            color: white;
            padding: 4px 12px;
            border-radius: 9999px;
            font-weight: 600;
        }

        /* 차원별 결과 카드 스타일 */
        .dimension-result-card {
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        /* 불일치 (설득 성공) - 퍼플/핑크 계열 */
        .mismatch-success {
            background-color: #fef0ff;
            border: 1px solid #ff71c6;
        }
        /* 일치 (완벽 일치) - 그린 계열 */
        .match-perfect {
            background-color: #f0fff8;
            border: 1px solid #68d391;
        }

        .persuasion-bar-container {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            flex-grow: 1;
        }

        /* 설득 성공 바 (퍼플/핑크 그라데이션) */
        .persuasion-fill {
            height: 100%;
            background: linear-gradient(90deg, #b862ff, #ff71c6);
            border-radius: 4px;
        }
        /* 완벽 일치 바 (그린) */
        .match-fill {
            height: 100%;
            background-color: #68d391;
            border-radius: 4px;
        }

        .result-icon {
            font-size: 1.5rem;
            width: 24px;
            height: 24px;
        }

        .icon-check {
            color: #28a745;
        }
        .icon-cross {
            color: #dc3545;
        }

        /* AI 상세 분석 지표 스타일 */
        .ai-analysis-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            border: 1px solid #f3f4f6;
            margin-bottom: 1rem;
        }
        .ai-analysis-header {
            font-weight: bold;
            color: #6C5CE7;
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .mbti-dim-tag {
            color: white;
            padding: 2px 8px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.75rem;
            text-align: center;
            width: 32px;
        }
        .tag-e, .tag-i, .tag-s, .tag-n, .tag-t, .tag-f, .tag-j, .tag-p {
            background-color: #6C5CE7;
        }
        .tag-e, .tag-s, .tag-t, .tag-j {
            background-color: #6C5CE7;
        }
        .tag-i, .tag-n, .tag-f, .tag-p {
            background-color: #1A73E8;
        }
        .dim-row {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .dim-center {
            flex-grow: 1;
            text-align: center;
            font-weight: 600;
            color: #374151;
            margin: 0 1rem;
        }
        .dim-bar-container {
            height: 30px;
            background-color: #f3f4f6;
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            align-items: center;
            margin-top: 4px;
        }
        .dim-percent {
            width: 50%;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #1f2937;
        }

        /* 라운드별 설득률 스타일 */
        .round-rates-container {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid #e5e7eb;
        }
        .round-rate-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .round-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            width: 4rem;
        }
        .round-rate-bar {
            flex-grow: 1;
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        .round-rate-fill {
            height: 100%;
            background: linear-gradient(90deg, #b862ff, #ff71c6);
            border-radius: 3px;
        }
        .round-rate-value {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            width: 3rem;
            text-align: right;
        }
    </style>
</head>
<body class="flex justify-center py-8 px-4">

<div class="max-w-xl w-full text-left space-y-4">

    <div class="result-header">
        <h3 class="text-xl font-bold text-gray-900">최종 결과</h3>
        <p class="text-sm text-gray-500">당신의 캐릭터 해석(캐해력) 검증 결과입니다</p>
    </div>

    <div class="ui-card info-card mb-6">
        <div class="flex items-center space-x-4">
            <div class="flex-grow">
                <p class="text-xl font-bold text-gray-800" th:text="${characterName}">독고</p>
                <p class="text-sm text-gray-500" th:text="${title}">불편한 편의점</p>
            </div>
        </div>

        <div class="flex flex-col items-end space-y-1 text-xs">
            <span class="mbti-tag-user" th:text="|당신: ${fullMbti}|">당신: ESTJ</span>
            <span class="mbti-tag-ai" th:text="|AI: ${aiThing}|">AI: ISFJ</span>
        </div>
    </div>

    <div class="ui-card mb-6">
        <h5 class="font-bold text-gray-800 mb-3">AI의 생각 변화</h5>
        <div class="space-y-2 text-sm text-gray-700">
            <div class="flex justify-between items-center" th:if="${eiPersuasionRate != 0}">
                <span th:text="|AI의 ${ei} 성향 <strong>${eiPersuasionRate}%</strong> 변화|">AI의 E 성향 <strong>91%</strong> 변화</span>
                <span class="text-gray-500" th:text="|${aiEi} &rarr; ${ei}|">I &rarr; E</span>
            </div>
            <div class="flex justify-between items-center" th:if="${snPersuasionRate != 0}">
                <span th:text="|AI의 ${sn} 성향 <strong>${snPersuasionRate}%</strong> 변화|">AI의 S 성향 <strong>0%</strong> 변화</span>
                <span class="text-gray-500" th:text="|${aiSn} &rarr; ${sn}|">S &rarr; S</span>
            </div>
            <div class="flex justify-between items-center" th:if="${tfPersuasionRate != 0}">
                <span th:text="|AI의 ${tf} 성향 <strong>${tfPersuasionRate}%</strong> 변화|">AI의 T 성향 <strong>100%</strong> 변화</span>
                <span class="text-gray-500" th:text="|${aiTf} &rarr; ${tf}|">F &rarr; T</span>
            </div>
            <div class="flex justify-between items-center" th:if="${jpPersuasionRate != 0}">
                <span th:text="|AI의 ${jp} 성향 <strong>${jpPersuasionRate}%</strong> 변화|">AI의 J 성향 <strong>0%</strong> 변화</span>
                <span class="text-gray-500" th:text="|${aiJp} &rarr; ${jp}|">J &rarr; J</span>
            </div>
        </div>
    </div>

    <div class="ai-analysis-card">
        <div class="ai-analysis-header">
            <i data-lucide="line-chart" class="w-5 h-5 mr-2"></i>
            AI 분석 상세 지표 (퍼센트)
        </div>

        <div class="dim-row">
            <div class="mbti-dim-tag tag-e">E 외향</div>
            <div class="dim-center">에너지의 방향성</div>
            <div class="mbti-dim-tag tag-i">내향 I</div>
        </div>
        <div class="dim-bar-container mb-4">
            <div class="dim-percent">
                <span class="text-gray-400" th:text="|${valueE}%|">30%</span>
                <span th:text="|${finalE}%|"
                      th:class="${eiMismatch and ei == 'E'} ? 'text-green-600' : 'text-gray-400'">30%</span>
            </div>
            <div class="dim-percent text-right">
                <span th:text="|${finalI}%|"
                      th:class="${eiMismatch and ei == 'I'} ? 'text-green-600' : 'text-gray-400'">70%</span>
                <span class="text-gray-400" th:text="|${valueI}%|">70%</span>
            </div>
        </div>

        <div class="dim-row">
            <div class="mbti-dim-tag tag-s">S 감각</div>
            <div class="dim-center">인식 기능</div>
            <div class="mbti-dim-tag tag-n">직관 N</div>
        </div>
        <div class="dim-bar-container mb-4">
            <div class="dim-percent">
                <span class="text-gray-400" th:text="|${valueS}%|">85%</span>
                <span th:text="|${finalS}%|"
                      th:class="${snMismatch and sn == 'S'} ? 'text-green-600' : 'text-gray-400'">85%</span>
            </div>
            <div class="dim-percent text-right">
                <span th:text="|${finalN}%|"
                      th:class="${snMismatch and sn == 'N'} ? 'text-green-600' : 'text-gray-400'">15%</span>
                <span class="text-gray-400" th:text="|${valueN}%|">15%</span>
            </div>
        </div>

        <div class="dim-row">
            <div class="mbti-dim-tag tag-t">T 사고</div>
            <div class="dim-center">판단 기능</div>
            <div class="mbti-dim-tag tag-f">감정 F</div>
        </div>
        <div class="dim-bar-container mb-4">
            <div class="dim-percent">
                <span class="text-gray-400" th:text="|${valueT}%|">20%</span>
                <span th:text="|${finalT}%|"
                      th:class="${tfMismatch and tf == 'T'} ? 'text-green-600' : 'text-gray-400'">20%</span>
            </div>
            <div class="dim-percent text-right">
                <span th:text="|${finalF}%|"
                      th:class="${tfMismatch and tf == 'F'} ? 'text-green-600' : 'text-gray-400'">80%</span>
                <span class="text-gray-400" th:text="|${valueF}%|">80%</span>
            </div>
        </div>

        <div class="dim-row">
            <div class="mbti-dim-tag tag-j">J 판단</div>
            <div class="dim-center">생활 양식</div>
            <div class="mbti-dim-tag tag-p">인식 P</div>
        </div>
        <div class="dim-bar-container">
            <div class="dim-percent">
                <span class="text-gray-400" th:text="|${valueJ}%|">25%</span>
                <span th:text="|${finalJ}%|"
                      th:class="${jpMismatch and jp == 'J'} ? 'text-green-600' : 'text-gray-400'">25%</span>
            </div>
            <div class="dim-percent text-right">
                <span th:text="|${finalP}%|"
                      th:class="${jpMismatch and jp == 'P'} ? 'text-green-600' : 'text-gray-400'">75%</span>
                <span class="text-gray-400" th:text="|${valueP}%|">75%</span>
            </div>
        </div>

        <p class="text-xs text-gray-500 mt-4 text-center">
            * 왼/오: 초기 분석 퍼센트 &rarr; 설득 후 최종 퍼센트
        </p>
    </div>
    <div class="flex items-center text-gray-600 font-bold mb-4">
        <i data-lucide="zap" class="w-5 h-5 mr-2 text-purple-500"></i>
        <h4 class="text-lg">차원별 대결 결과</h4>
    </div>

    <!-- 에너지 방향 (EI) - 설득을 시도했고 불일치가 있는 경우만 표시 -->
    <div class="dimension-result-card space-y-3" th:if="${eiPersuaded and eiMismatch}" th:classappend="'mismatch-success'">
        <div class="flex justify-between items-center">
            <span class="font-bold text-gray-800">에너지 방향</span>
            <div class="flex items-center space-x-1 text-sm font-semibold">
                <span class="text-purple-600" th:text="|당신: ${ei}|">당신: E</span>
                <i data-lucide="x" class="result-icon icon-cross" th:if="${eiMismatch}"></i>
                <i data-lucide="check" class="result-icon icon-check" th:if="${!eiMismatch}"></i>
                <span class="text-blue-600" th:text="|AI: ${aiEi}|">AI: I</span>
            </div>
        </div>

        <div class="flex items-center space-x-3">
            <div class="persuasion-bar-container">
                <div th:if="${eiMismatch}" class="persuasion-fill" th:style="|width: ${eiPersuasionRate}%;|"></div>
                <div th:if="${!eiMismatch}" class="match-fill" style="width: 100%;"></div>
            </div>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${eiMismatch}" th:text="|총 설득률: ${eiPersuasionRate}%|">
                총 설득률: 91%
            </span>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${!eiMismatch}">완벽 일치</span>
        </div>

        <div class="round-rates-container" th:if="${eiMismatch}">
            <div class="text-xs font-semibold text-gray-600 mb-2">라운드별 설득률</div>
            <div th:if="${eiRoundRates != null and !eiRoundRates.isEmpty()}">
                <div class="round-rate-item" th:each="rate, iterStat : ${eiRoundRates}">
                    <span class="round-label" th:text="|라운드 ${iterStat.index + 1}|">라운드 1</span>
                    <div class="round-rate-bar">
                        <div class="round-rate-fill" th:style="|width: ${rate}%;|"></div>
                    </div>
                    <span class="round-rate-value" th:text="|${rate}%|">0%</span>
                </div>
            </div>
            <div class="text-xs text-gray-400 italic" th:if="${eiRoundRates == null or eiRoundRates.isEmpty()}">
                라운드 데이터가 없습니다.
            </div>
        </div>

        <div class="flex items-center text-sm font-semibold text-green-600 pt-1">
            <i data-lucide="check-square" class="result-icon icon-check mr-1"></i>
            <span th:if="${eiMismatch}">설득력 있는 논거를 제시했습니다!</span>
            <span th:if="${!eiMismatch}">100% 일치</span>
        </div>
    </div>

    <!-- 인식 기능 (SN) - 설득을 시도했고 불일치가 있는 경우만 표시 -->
    <div class="dimension-result-card space-y-3" th:if="${snPersuaded and snMismatch}" th:classappend="'mismatch-success'">
        <div class="flex justify-between items-center">
            <span class="font-bold text-gray-800">인식 기능</span>
            <div class="flex items-center space-x-1 text-sm font-semibold">
                <span class="text-purple-600" th:text="|당신: ${sn}|">당신: S</span>
                <i data-lucide="x" class="result-icon icon-cross" th:if="${snMismatch}"></i>
                <i data-lucide="check" class="result-icon icon-check" th:if="${!snMismatch}"></i>
                <span class="text-blue-600" th:text="|AI: ${aiSn}|">AI: S</span>
            </div>
        </div>

        <div class="flex items-center space-x-3">
            <div class="persuasion-bar-container">
                <div th:if="${snMismatch}" class="persuasion-fill" th:style="|width: ${snPersuasionRate}%;|"></div>
                <div th:if="${!snMismatch}" class="match-fill" style="width: 100%;"></div>
            </div>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${snMismatch}" th:text="|총 설득률: ${snPersuasionRate}%|">
                총 설득률: 0%
            </span>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${!snMismatch}">완벽 일치</span>
        </div>

        <div class="round-rates-container" th:if="${snMismatch}">
            <div class="text-xs font-semibold text-gray-600 mb-2">라운드별 설득률</div>
            <div th:if="${snRoundRates != null and !snRoundRates.isEmpty()}">
                <div class="round-rate-item" th:each="rate, iterStat : ${snRoundRates}">
                    <span class="round-label" th:text="|라운드 ${iterStat.index + 1}|">라운드 1</span>
                    <div class="round-rate-bar">
                        <div class="round-rate-fill" th:style="|width: ${rate}%;|"></div>
                    </div>
                    <span class="round-rate-value" th:text="|${rate}%|">0%</span>
                </div>
            </div>
            <div class="text-xs text-gray-400 italic" th:if="${snRoundRates == null or snRoundRates.isEmpty()}">
                라운드 데이터가 없습니다.
            </div>
        </div>

        <div class="flex items-center text-sm font-semibold text-green-600 pt-1">
            <i data-lucide="check-square" class="result-icon icon-check mr-1"></i>
            <span th:if="${snMismatch}">설득력 있는 논거를 제시했습니다!</span>
            <span th:if="${!snMismatch}">100% 일치</span>
        </div>
    </div>

    <!-- 판단 기능 (TF) - 설득을 시도했고 불일치가 있는 경우만 표시 -->
    <div class="dimension-result-card space-y-3" th:if="${tfPersuaded and tfMismatch}" th:classappend="'mismatch-success'">
        <div class="flex justify-between items-center">
            <span class="font-bold text-gray-800">판단 기능</span>
            <div class="flex items-center space-x-1 text-sm font-semibold">
                <span class="text-purple-600" th:text="|당신: ${tf}|">당신: T</span>
                <i data-lucide="x" class="result-icon icon-cross" th:if="${tfMismatch}"></i>
                <i data-lucide="check" class="result-icon icon-check" th:if="${!tfMismatch}"></i>
                <span class="text-blue-600" th:text="|AI: ${aiTf}|">AI: F</span>
            </div>
        </div>

        <div class="flex items-center space-x-3">
            <div class="persuasion-bar-container">
                <div th:if="${tfMismatch}" class="persuasion-fill" th:style="|width: ${tfPersuasionRate}%;|"></div>
                <div th:if="${!tfMismatch}" class="match-fill" style="width: 100%;"></div>
            </div>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${tfMismatch}" th:text="|총 설득률: ${tfPersuasionRate}%|">
                총 설득률: 100%
            </span>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${!tfMismatch}">완벽 일치</span>
        </div>

        <div class="round-rates-container" th:if="${tfMismatch}">
            <div class="text-xs font-semibold text-gray-600 mb-2">라운드별 설득률</div>
            <div th:if="${tfRoundRates != null and !tfRoundRates.isEmpty()}">
                <div class="round-rate-item" th:each="rate, iterStat : ${tfRoundRates}">
                    <span class="round-label" th:text="|라운드 ${iterStat.index + 1}|">라운드 1</span>
                    <div class="round-rate-bar">
                        <div class="round-rate-fill" th:style="|width: ${rate}%;|"></div>
                    </div>
                    <span class="round-rate-value" th:text="|${rate}%|">0%</span>
                </div>
            </div>
            <div class="text-xs text-gray-400 italic" th:if="${tfRoundRates == null or tfRoundRates.isEmpty()}">
                라운드 데이터가 없습니다.
            </div>
        </div>

        <div class="flex items-center text-sm font-semibold text-green-600 pt-1">
            <i data-lucide="check-square" class="result-icon icon-check mr-1"></i>
            <span th:if="${tfMismatch}">설득력 있는 논거를 제시했습니다!</span>
            <span th:if="${!tfMismatch}">100% 일치</span>
        </div>
    </div>

    <!-- 생활 양식 (JP) - 설득을 시도했고 불일치가 있는 경우만 표시 -->
    <div class="dimension-result-card space-y-3" th:if="${jpPersuaded and jpMismatch}" th:classappend="'mismatch-success'">
        <div class="flex justify-between items-center">
            <span class="font-bold text-gray-800">생활 양식</span>
            <div class="flex items-center space-x-1 text-sm font-semibold">
                <span class="text-purple-600" th:text="|당신: ${jp}|">당신: J</span>
                <i data-lucide="x" class="result-icon icon-cross" th:if="${jpMismatch}"></i>
                <i data-lucide="check" class="result-icon icon-check" th:if="${!jpMismatch}"></i>
                <span class="text-blue-600" th:text="|AI: ${aiJp}|">AI: J</span>
            </div>
        </div>

        <div class="flex items-center space-x-3">
            <div class="persuasion-bar-container">
                <div th:if="${jpMismatch}" class="persuasion-fill" th:style="|width: ${jpPersuasionRate}%;|"></div>
                <div th:if="${!jpMismatch}" class="match-fill" style="width: 100%;"></div>
            </div>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${jpMismatch}" th:text="|총 설득률: ${jpPersuasionRate}%|">
                총 설득률: 0%
            </span>
            <span class="text-sm font-bold text-gray-700 w-24 text-right" th:if="${!jpMismatch}">완벽 일치</span>
        </div>

        <div class="round-rates-container" th:if="${jpMismatch}">
            <div class="text-xs font-semibold text-gray-600 mb-2">라운드별 설득률</div>
            <div th:if="${jpRoundRates != null and !jpRoundRates.isEmpty()}">
                <div class="round-rate-item" th:each="rate, iterStat : ${jpRoundRates}">
                    <span class="round-label" th:text="|라운드 ${iterStat.index + 1}|">라운드 1</span>
                    <div class="round-rate-bar">
                        <div class="round-rate-fill" th:style="|width: ${rate}%;|"></div>
                    </div>
                    <span class="round-rate-value" th:text="|${rate}%|">0%</span>
                </div>
            </div>
            <div class="text-xs text-gray-400 italic" th:if="${jpRoundRates == null or jpRoundRates.isEmpty()}">
                라운드 데이터가 없습니다.
            </div>
        </div>

        <div class="flex items-center text-sm font-semibold text-green-600 pt-1">
            <i data-lucide="check-square" class="result-icon icon-check mr-1"></i>
            <span th:if="${jpMismatch}">설득력 있는 논거를 제시했습니다!</span>
            <span th:if="${!jpMismatch}">100% 일치</span>
        </div>
    </div>
</div>

<script>
    // Lucide Icons 초기화
    lucide.createIcons();
</script>
</body>
</html>